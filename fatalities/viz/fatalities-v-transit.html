<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Fatalities vs Trainst Scatterplot</title>

    <style>
      html, body {
        overflow: hidden;
      }

      #container {
        height: 100vh;
        width: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>

  <body>
    <div id="container"></div>

    <pre id="csv" style="display: none">
      Town,Transit,Transit_moe,Population,Crashes_2013_2017,CrashRate
      Andover,1,1.1,3179,4,25.16514627
      Ansonia,2.7,1.4,18953,1,1.055241914
      Ashford,0.5,0.8,4254,3,14.10437236
      Avon,1.4,0.7,18381,2,2.176160165
      Barkhamsted,0.1,0.2,3693,3,16.2469537
      Beacon Falls,1.8,1.7,6108,2,6.548788474
      Berlin,1.2,0.9,20584,13,12.63116984
      Bethany,1.2,1.1,5526,4,14.47701773
      Bethel,4.6,1.1,19526,3,3.072825976
      Bethlehem,0.4,0.7,3490,1,5.730659026
      Bloomfield,3.1,1.4,20848,17,16.3085188
      Bolton,0,1.2,4947,4,16.17141702
      Bozrah,0.5,0.7,2587,4,30.92385002
      Branford,2.1,0.8,28149,9,6.394543323
      Bridgeport,11.8,1,147586,45,6.09813939
      Bridgewater,5.8,5.1,1681,2,23.7953599
      Bristol,1.2,0.5,60498,21,6.94237826
      Brookfield,1.4,1,17064,9,10.54852321
      Brooklyn,0,0.9,8232,8,19.43634597
      Burlington,0.5,0.6,9598,1,2.083767452
      Canaan,0.4,0.7,1128,3,53.19148936
      Canterbury,0.5,0.7,5074,3,11.82499015
      Canton,1.9,1.2,10339,5,9.672115292
      Chaplin,0.5,0.8,2365,3,25.36997886
      Cheshire,0.8,0.5,29274,11,7.515201202
      Chester,0.9,1,4286,2,9.332711153
      Clinton,2.7,1.1,13041,4,6.134498888
      Colchester,1.1,0.6,16015,5,6.244146113
      Colebrook,0,3.8,1471,1,13.59619307
      Columbia,0,1.1,5442,5,18.37559721
      Cornwall,6.5,3,1364,,0
      Coventry,0.4,0.6,12458,8,12.84315299
      Cromwell,0.8,0.5,14021,7,9.985022466
      Danbury,4.4,0.9,84573,32,7.567426957
      Darien,28.1,2.7,21742,3,2.759635728
      Deep River,1.1,1.1,4547,4,17.59401803
      Derby,1,1.3,12700,4,6.299212598
      Durham,0.8,0.9,7292,4,10.97092704
      East Granby,0.7,1.1,5220,4,15.3256705
      East Haddam,0.2,0.3,9072,7,15.43209877
      East Hampton,0.4,0.5,12890,5,7.757951901
      East Hartford,4.5,1,50812,31,12.20184208
      East Haven,2.7,1,29006,15,10.34268772
      East Lyme,0.8,0.5,18883,8,8.473229889
      East Windsor,0,0.1,11409,5,8.76501008
      Eastford,0,3.6,1639,4,48.81025015
      Easton,6.5,2.4,7607,1,2.629157355
      Ellington,1.1,1,15948,3,3.762227239
      Enfield,0.5,0.2,44608,17,7.62195122
      Essex,7.5,3.7,6588,4,12.14329083
      Fairfield,12.6,1.2,61611,15,4.869260359
      Farmington,1,0.5,25596,16,12.50195343
      Franklin,1.6,1.3,1908,2,20.96436059
      Glastonbury,0.9,0.4,34688,4,2.306273063
      Goshen,2,1.7,2914,1,6.863417982
      Granby,0.4,0.4,11323,7,12.36421443
      Greenwich,20.3,1.7,62782,12,3.822751744
      Griswold,0.3,0.4,11791,7,11.87346281
      Groton,1.7,0.6,39492,6,3.038590094
      Guilford,2.3,0.8,22377,10,8.937748581
      Haddam,1.3,1.2,8303,3,7.226303746
      Hamden,4.2,1.2,61493,12,3.902883255
      Hampton,0.7,0.7,1829,2,21.86987425
      Hartford,15.1,1.4,124390,46,7.396092934
      Hartland,0.5,0.7,2083,2,19.20307249
      Harwinton,0.1,0.3,5526,10,36.19254434
      Hebron,1.9,1.3,9550,11,23.03664921
      Kent,4.6,3.1,2853,1,7.010164739
      Killingly,0.6,0.7,17160,15,17.48251748
      Killingworth,0,1,6441,2,6.210215805
      Lebanon,0.9,1,7242,5,13.80834024
      Ledyard,0.6,0.5,14926,11,14.73938095
      Lisbon,1.1,1.5,4300,,0
      Litchfield,0.3,0.3,8252,6,14.54192923
      Lyme,1.8,1.2,2423,2,16.50846059
      Madison,3.6,1.6,18247,6,6.576423522
      Manchester,2.4,0.6,58172,19,6.532352334
      Mansfield,3.9,1.5,26019,9,6.918021446
      Marlborough,0.5,0.8,6420,7,21.80685358
      Meriden,1.9,0.5,60241,21,6.971995817
      Middlebury,0.7,0.8,7658,8,20.8931836
      Middlefield,0.3,0.5,4402,1,4.543389368
      Middletown,2.2,0.7,46747,13,5.561854237
      Milford,5,0.7,53867,15,5.569272467
      Monroe,2.2,1.1,19766,5,5.059192553
      Montville,0.7,0.5,19384,10,10.31778787
      Morris,2.1,1.7,2367,1,8.449514153
      Naugatuck,1.1,0.8,31649,4,2.527725995
      New Britain,3.4,0.8,73069,18,4.926849964
      New Canaan,20.4,2.8,20357,1,0.9824630348
      New Fairfield,2.6,1.1,14091,5,7.096728408
      New Hartford,0.4,0.7,6794,7,20.60641743
      New Haven,12.4,1.2,130884,57,8.710002751
      New London,3,1.6,27147,5,3.683648285
      New Milford,1.5,0.7,27380,11,8.035062089
      Newington,1.5,0.6,30603,9,5.881776296
      Newtown,1.6,0.6,28030,9,6.421691045
      Norfolk,1.8,0.8,1442,1,13.86962552
      North Branford,0.3,0.4,14275,5,7.00525394
      North Canaan,0,1.7,3331,4,24.01681177
      North Haven,2.3,1.2,23877,17,14.23964485
      North Stonington,1,1.2,5255,7,26.64129401
      Norwalk,10.9,1.2,88537,24,5.421462214
      Norwich,3,1,39875,21,10.53291536
      Old Lyme,2.5,1.5,7494,14,37.36322391
      Old Saybrook,1.9,1.1,10162,7,13.77681559
      Orange,3,1.2,13981,11,15.73564123
      Oxford,0.3,0.5,12972,4,6.167129201
      Plainfield,0.7,0.9,15138,8,10.56942793
      Plainville,0.7,0.5,17805,6,6.739679865
      Plymouth,0.5,0.5,11888,3,5.047106326
      Pomfret,0,1.5,4184,3,14.34034417
      Portland,0,0.7,9391,13,27.68608242
      Preston,0.3,0.5,4693,10,42.61666312
      Prospect,0.1,0.2,9748,4,8.206811654
      Putnam,0.3,0.4,9395,7,14.90154337
      Redding,5,1.9,9274,,0
      Ridgefield,5.9,1.3,25206,2,1.586923748
      Rocky Hill,0.6,0.6,20015,9,8.993255059
      Roxbury,3.1,2,2231,3,26.89376961
      Salem,0.6,0.8,4162,3,14.41614608
      Salisbury,1.3,1.2,3658,4,21.86987425
      Scotland,0,3.5,1691,,0
      Seymour,1.8,1.1,16579,4,4.825381507
      Sharon,5.7,4,2733,,0
      Shelton,2.4,0.9,41282,21,10.17392568
      Sherman,3.8,2.6,3654,2,10.9469075
      Simsbury,1.7,0.6,24307,5,4.114041223
      Somers,0.7,0.6,11284,6,10.63452676
      South Windsor,1.5,0.6,25802,4,3.100534842
      Southbury,0.4,0.4,19675,10,10.16518424
      Southington,0.3,0.2,43817,22,10.04176461
      Sprague,0,2.1,2942,2,13.59619307
      Stafford,0.4,0.3,11901,3,5.041593143
      Stamford,14.7,1.1,128851,34,5.277413447
      Sterling,0.5,0.8,3748,2,10.67235859
      Stonington,1.1,0.6,18483,11,11.90282963
      Stratford,5.9,1,52529,16,6.091873061
      Suffield,0.7,0.7,15675,6,7.655502392
      Thomaston,0.2,0.3,7668,2,5.21648409
      Thompson,0.4,0.4,9299,7,15.0553823
      Tolland,1.3,1,14838,5,6.739452756
      Torrington,1.5,0.7,35078,11,6.271737271
      Trumbull,3.3,0.9,36455,12,6.583459059
      Union,0,6.6,932,3,64.3776824
      Vernon,4.8,1.9,29182,8,5.482831883
      Voluntown,0,2.4,2570,2,15.56420233
      Wallingford,0.7,0.4,44991,18,8.00160032
      Warren,6.4,2.6,1467,2,27.26653033
      Washington,6.4,3.2,3489,5,28.6615076
      Waterbury,4.6,0.7,109250,69,12.63157895
      Waterford,0.7,0.5,19200,8,8.333333333
      Watertown,0.4,0.4,21976,6,5.460502366
      West Hartford,2.6,0.5,63360,13,4.103535354
      West Haven,6.2,1.5,55044,16,5.813530993
      Westbrook,2.4,1.5,6927,4,11.54901112
      Weston,12.1,2.6,10369,,0
      Westport,22.2,2.6,27777,14,10.08028225
      Wethersfield,1.1,0.6,26395,12,9.09263118
      Willington,0.4,0.7,5916,9,30.42596349
      Wilton,14,2.1,18659,4,4.287475213
      Winchester,2.8,2,10894,,0
      Windham,1.2,0.7,24839,9,7.246668545
      Windsor,3.9,1.1,29037,4,2.755105555
      Windsor Locks,0.9,0.6,12563,4,6.367905755
      Wolcott,0.2,0.2,16696,2,2.395783421
      Woodbridge,2.8,1.9,8907,5,11.22712473
      Woodbury,1,0.8,9686,6,12.38901507
      Woodstock,0.4,0.6,7827,5,12.77628721
    </pre>

    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/data.js"></script>
    <script src="https://rawgithub.com/phpepe/highcharts-regression/master/highcharts-regression.js?8"></script>
    <script src="https://code.highcharts.com/highcharts-more.js"></script>

    <script>

      Highcharts.setOptions({
          lang: {
              thousandsSep: ','
          }
      });

      var regressionData = [];
      for (var i = 0; i < 31; i++) {
        regressionData.push([i, 17.5*Math.pow(Math.E, -0.0677*i)]);
      }

      Highcharts.chart('container', {

        chart: {
          type: 'scatter',
          zoomType: 'xy',
          style: {
            fontFamily: 'Arial',
          }
        },

        credits: {
          enabled: false,
        },

        title: {
          text: '<b>Crash Fatalities vs Public Transit in Connecticut Towns</b>'
        },
        subtitle: {
          text: 'Source: ACS 2017 5-year estimates; UCONN Crash Data (2013-2017)'
        },

        data: {
          csv: document.getElementById('csv').innerHTML,
          seriesMapping: [{ name: 0, x: 1, y: 5, transit_moe: 2, pop: 3, crashes: 4 }]
        },

        xAxis: {
          title: {
            enabled: true,
            text: 'Public Transit Rate (%)'
          },
          min: 0,
          gridLineWidth: 1,
          tickWidth: 0,
        },

        yAxis: {
          title: {
            text: 'Crash Fatalities Rate (per 100,000 residents)'
          },
          min: 0,
          gridLineWidth: 1,
        },

        legend: {
          enabled: false,
        },

        plotOptions: {
          line: {
            marker: {
              enabled: false
            }
          },
          scatter: {
            marker: {
              radius: 5,
              states: {
                hover: {
                  enabled: true,
                  lineColor: 'red',
                  fillColor: 'red',
                  shadow: false,
                  radiusPlus: 5,
                  lineWidthPlus: 0,
                }
              }
            },
            states: {
              hover: {
                marker: {
                  enabled: false
                }
              }
            },
            tooltip: {
              headerFormat: '',
              pointFormat: '<b>{point.name}</b> <br> Public Transit Rate: <b>{point.x}%</b> ± {point.transit_moe}<br> \
                Average Crash Fatalities Rate: <b>{point.y}</b> persons per 100,000 residents \
                <br> Fatalities in 2013-2017: <b>{point.crashes}</b> \
                <br> Population: {point.pop:,.0f} people',
              formatter: function() {
                return 'hello'
              },
              valueDecimals: 1,
              useHTML: true,
            }
          }
        },

        series: [
          {
            color: '#333'
          },
          {
            data: regressionData,
            type: 'line',
            enableMouseTracking: false,
            color: 'red',
          }
        ]
      });
    </script>


  </body>
</html>
